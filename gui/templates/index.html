<script>
  const COINS = ["BTCUSDT","ETHUSDT","BNBUSDT"]; // laajenna halutessa

  async function loadAll(){
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    for (const s of COINS){
      try {
        const r = await fetch('/api/data/' + s, { cache: 'no-store' });
        const d = await r.json();

        if (d.error || d.rsi === undefined || d.rsi === null) {
          grid.innerHTML += `
            <div class="card sig-hold">
              <h3>${d.symbol || s}</h3>
              <div><b>Data unavailable</b></div>
              ${d.error ? `<small>Error: ${d.error}</small>` : `<small>Waiting for data...</small>`}
            </div>`;
          continue;
        }

        const cls = d.signal === 'BUY' ? 'sig-buy' : d.signal === 'SELL' ? 'sig-sell' : 'sig-hold';
        grid.innerHTML += `
          <div class="card ${cls}">
            <h3>${d.symbol}</h3>
            <div>RSI: <b>${d.rsi}</b></div>
            <div>EMA9: <b>${d.ema9}</b></div>
            <div>EMA20: <b>${d.ema20}</b></div>
            <small>Signal: ${d.signal}</small>
          </div>`;
      } catch (e) {
        grid.innerHTML += `
          <div class="card sig-hold">
            <h3>${s}</h3>
            <div><b>Request failed</b></div>
            <small>${String(e)}</small>
          </div>`;
      }
    }
  }
  window.onload = () => { loadAll(); setInterval(loadAll, 20000); };
</script>
